/*--------------------------------*- C++ -*----------------------------------*\
| =========                 |                                                 |
| \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox           |
|  \\    /   O peration     | Version:  2412                                  |
|   \\  /    A nd           | Website:  www.openfoam.com                      |
|    \\/     M anipulation  |                                                 |
\*---------------------------------------------------------------------------*/
FoamFile
{
    version         2.0;
    format          ascii;
    class           dictionary;
    object          snappyHexMeshDict;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

#includeEtc "caseDicts/mesh/generation/snappyHexMeshDict.cfg"

castellatedMesh on;
snap            on;
addLayers       off;

geometry
{
    // 1. Définition des fichiers STL générés par Python
    gas.stl       { type triSurfaceMesh; name gas; }
    sphere.stl    { type triSurfaceMesh; name sphere; }
    box_xmin.stl  { type triSurfaceMesh; name box_xmin; }
    box_xmax.stl  { type triSurfaceMesh; name box_xmax; }
    
    // Faces externes (pour conditions limites précises)
    external_box_xmin.stl { type triSurfaceMesh; name external_box_xmin; }
    external_box_xmax.stl { type triSurfaceMesh; name external_box_xmax; }
}

castellatedMeshControls
{
    nCellsBetweenLevels 3;

    // Gestion des interfaces multi-matériaux
    allowFreeStandingZoneFaces true;

    features
    (
        { file "gas.eMesh"; level 1; }
        { file "sphere.eMesh"; level 1; }
    );

    refinementSurfaces
    {
        // Niveau de raffinement (min max)
        gas         { level (0 0); }
        sphere      { level (2 2); } 
        box_xmin    { level (0 0); }
        box_xmax    { level (0 0); }

        external_box_xmin { level (0 0); }
        external_box_xmax { level (0 0); }
    }

    resolveFeatureAngle 30;

    refinementRegions
    {
    }

    // C'EST ICI QUE PYTHON VA INJECTER LES COORDONNEES
    locationsInMesh
    (
        ((LOC_X_GAS   LOC_Y_GAS   LOC_Z_GAS)    gas)
        ((LOC_X_SPHERE LOC_Y_SPHERE LOC_Z_SPHERE) sphere)
        ((LOC_X_XMIN  LOC_Y_XMIN  LOC_Z_XMIN)   box_xmin)
        ((LOC_X_XMAX  LOC_Y_XMAX  LOC_Z_XMAX)   box_xmax)
    );
}

snapControls
{
    implicitFeatureSnap true;
    multiRegionFeatureSnap true; 
    nSmoothPatch 3;
    tolerance 2.0;
    nSolveIter 30;
    nRelaxIter 5;
}

addLayersControls
{
    relativeSizes true;
    layers
    {
        "sphere_.*" { nSurfaceLayers 2; }
    }
    expansionRatio 1.1;
    finalLayerThickness 0.3;
    minThickness 0.1;
}

meshQualityControls
{
    #include "meshQualityDict"
}

mergeTolerance 1e-6;

// ************************************************************************* //
